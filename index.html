<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portim√£o Bus Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 14px; }
        .content { padding: 30px; }
        .location-section {
            background: #f7f9fc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .location-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }
        .status-icon.active {
            background: #10b981;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }
        button:hover { transform: translateY(-2px); }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .select-wrapper { margin-bottom: 20px; }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }
        select:focus { outline: none; border-color: #667eea; }
        .route-info {
            background: #f0fdf4;
            border-left: 4px solid #10b981;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .route-info.show { display: block; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .route-info h3 { color: #065f46; margin-bottom: 15px; font-size: 18px; }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #d1fae5;
        }
        .info-row:last-child { border-bottom: none; }
        .info-label { color: #6b7280; font-weight: 500; }
        .info-value { color: #065f46; font-weight: 600; }
        .next-buses {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #d1fae5;
        }
        .bus-time {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .time-large { font-size: 16px; font-weight: 700; color: #667eea; }
        .time-info { font-size: 14px; color: #6b7280; }
        .error {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            padding: 15px;
            border-radius: 8px;
            color: #991b1b;
            margin-bottom: 20px;
        }
        .coordinates {
            font-size: 12px;
            color: #6b7280;
            margin-top: 10px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöå Uber da Tania</h1>
            <p>Para quando o Pai n√£o est√° disponivel</p>
        </div>
        <div class="content">
            <div class="select-wrapper">
                <label for="routeSelect">Select Route:</label>
                <select id="routeSelect" onchange="changeRoute()">
                    <option value="11-out">Route 11 - Fortaleza ‚Üí Igreja de Penina</option>
                    <option value="11-in">Route 11 - Igreja de Penina ‚Üí Fortaleza</option>
                    <option value="12-out">Route 12 - Gare Rodovi√°ria ‚Üí Montes de Alvor</option>
                    <option value="12-in">Route 12 - Montes de Alvor ‚Üí Gare Rodovi√°ria</option>
                    <option value="34-out">Route 34 - Ladeira do Vau ‚Üí EB23/S Bemposta</option>
                    <option value="34-in">Route 34 - EB23/S Bemposta ‚Üí Ladeira do Vau</option>
                </select>
            </div>
            <div class="location-section">
                <div class="location-status">
                    <div class="status-icon" id="statusIcon"></div>
                    <span id="locationStatus">Location tracking disabled</span>
                </div>
                <button onclick="getLocation()" id="locationBtn">üìç Get My Location</button>
                <div class="coordinates" id="coordinates"></div>
            </div>
            <div id="errorMessage"></div>
            <div class="select-wrapper">
                <label for="fromStop">From:</label>
                <select id="fromStop" onchange="calculateRoute()">
                    <option value="">-- Select starting stop --</option>
                </select>
            </div>
            <div class="select-wrapper">
                <label for="toStop">To:</label>
                <select id="toStop" onchange="calculateRoute()">
                    <option value="">-- Select destination --</option>
                </select>
            </div>
            <div class="route-info" id="routeInfo">
                <h3>üìã Journey Details</h3>
                <div class="info-row">
                    <span class="info-label">From:</span>
                    <span class="info-value" id="fromDisplay"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">To:</span>
                    <span class="info-value" id="toDisplay"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Stops:</span>
                    <span class="info-value" id="stopsCount"></span>
                </div>
                <div class="next-buses">
                    <h4 style="margin-bottom: 12px; color: #065f46;">üïí Next Buses</h4>
                    <div id="busTimes"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const route11_outSchedule = {"stops": [{"name": "Fortaleza", "times": ["07:04", "07:46", "08:25", "09:30", "10:15", "11:00", "11:45", "12:30", "13:15", "14:00", "14:45", "15:30", "16:15", "17:00", "17:45"]}, {"name": "Farm\u00e1cia Praia da Rocha", "times": ["07:06", "07:48", "08:27", "09:32", "10:17", "11:02", "11:47", "12:32", "13:17", "14:02", "14:47", "15:32", "16:17", "17:02", "17:47"]}, {"name": "Quinta das Parreiras 1", "times": ["07:07", "07:49", "08:28", "09:33", "10:18", "11:03", "11:48", "12:33", "13:18", "14:03", "14:48", "15:33", "16:18", "17:03", "17:48"]}, {"name": "Encosta da Marina 1", "times": ["07:08", "07:50", "08:29", "09:34", "10:19", "11:04", "11:49", "12:34", "13:19", "14:04", "14:49", "15:34", "16:19", "17:04", "17:49"]}, {"name": "JI/EB1 Pontal 1", "times": ["07:09", "07:51", "08:30", "09:35", "10:20", "11:05", "11:50", "12:35", "13:20", "14:05", "14:50", "15:35", "16:20", "17:05", "17:50"]}, {"name": "EB23 D. Martinho C. Branco 1", "times": ["07:10", "07:52", "08:31", "09:36", "10:21", "11:06", "11:51", "12:36", "13:21", "14:06", "14:51", "15:36", "16:21", "17:06", "17:51"]}, {"name": "Sec. Poeta Ant\u00f3nio Aleixo 1", "times": ["07:12", "07:54", "08:33", "09:38", "10:23", "11:08", "11:53", "12:38", "13:23", "14:08", "14:53", "15:38", "16:23", "17:08", "17:53"]}, {"name": "Rainha D. Am\u00e9lia 1", "times": ["07:13", "07:55", "08:34", "09:39", "10:24", "11:09", "11:54", "12:39", "13:24", "14:09", "14:54", "15:39", "16:24", "17:09", "17:54"]}, {"name": "R. Sid\u00f3nio Pais 1", "times": ["07:13", "07:55", "08:34", "09:39", "10:24", "11:09", "11:54", "12:39", "13:24", "14:09", "14:54", "15:39", "16:24", "17:09", "17:54"]}, {"name": "Museu 1", "times": ["07:14", "07:56", "08:35", "09:40", "10:25", "11:10", "11:55", "12:40", "13:25", "14:10", "14:55", "15:40", "16:25", "17:10", "17:55"]}, {"name": "Clube Naval", "times": ["07:15", "07:57", "08:36", "09:41", "10:26", "11:11", "11:56", "12:41", "13:26", "14:11", "14:56", "15:41", "16:26", "17:11", "17:56"]}, {"name": "Av. Guanar\u00e9 1", "times": ["07:16", "07:58", "08:37", "09:42", "10:27", "11:12", "11:57", "12:42", "13:27", "14:12", "14:57", "15:42", "16:27", "17:12", "17:57"]}, {"name": "Largo do Dique 1", "times": ["07:17", "07:59", "08:38", "09:43", "10:28", "11:13", "11:58", "12:43", "13:28", "14:13", "14:58", "15:43", "16:28", "17:13", "17:58"]}, {"name": "C\u00e2mara Municipal 2", "times": ["07:18", "08:00", "08:39", "09:44", "10:29", "11:14", "11:59", "12:44", "13:29", "14:14", "14:59", "15:44", "16:29", "17:14", "17:59"]}, {"name": "Est. de Alvor", "times": ["07:19", "08:01", "08:40", "09:45", "10:30", "11:15", "12:00", "12:45", "13:30", "14:15", "15:00", "15:45", "16:30", "17:15", "18:00"]}, {"name": "EB1 Major David Neto 1", "times": ["07:20", "08:02", "08:41", "09:46", "10:31", "11:16", "12:01", "12:46", "13:31", "14:16", "15:01", "15:46", "16:31", "17:16", "18:01"]}, {"name": "Eng. Amaro da Costa", "times": ["07:21", "08:03", "08:42", "09:47", "10:32", "11:17", "12:02", "12:47", "13:32", "14:17", "15:02", "15:47", "16:32", "17:17", "18:02"]}, {"name": "Sec. Manuel T. Gomes 1", "times": ["07:22", "08:04", "08:43", "09:48", "10:33", "11:18", "12:03", "12:48", "13:33", "14:18", "15:03", "15:48", "16:33", "17:18", "18:03"]}, {"name": "Rot. Pedra Mourinha 1", "times": ["07:24", "08:06", "08:45", "09:50", "10:35", "11:20", "12:05", "12:50", "13:35", "14:20", "15:05", "15:50", "16:35", "17:20", "18:05"]}, {"name": "EB23 Eng. Nuno Mergulh\u00e3o", "times": ["07:25", "08:07", "08:46", "09:51", "10:36", "11:21", "12:06", "12:51", "13:36", "14:21", "15:06", "15:51", "16:36", "17:21", "18:06"]}, {"name": "Lu\u00eds de Cam\u00f5es 3", "times": ["07:25", "08:07", "08:46", "09:51", "10:36", "11:21", "12:06", "12:51", "13:36", "14:21", "15:06", "15:51", "16:36", "17:21", "18:06"]}, {"name": "Lu\u00eds de Cam\u00f5es 1", "times": ["07:27", "08:09", "08:48", "09:53", "10:38", "11:23", "12:08", "12:53", "13:38", "14:23", "15:08", "15:53", "16:38", "17:23", "18:08"]}, {"name": "JI/EB1 P. Mourinha / EB23 J. Fialho 1", "times": ["07:29", "08:11", "08:50", "09:55", "10:40", "11:25", "12:10", "12:55", "13:40", "14:25", "15:10", "15:55", "16:40", "17:25", "18:10"]}, {"name": "Trav. da Pedra 1", "times": ["07:29", "08:11", "08:50", "09:55", "10:40", "11:25", "12:10", "12:55", "13:40", "14:25", "15:10", "15:55", "16:40", "17:25", "18:10"]}, {"name": "Pedra Mourinha 1", "times": ["07:30", "08:12", "08:51", "09:56", "10:41", "11:26", "12:11", "12:56", "13:41", "14:26", "15:11", "15:56", "16:41", "17:26", "18:11"]}, {"name": "R. do Clube 1", "times": ["07:31", "08:13", "08:52", "09:57", "10:42", "11:27", "12:12", "12:57", "13:42", "14:27", "15:12", "15:57", "16:42", "17:27", "18:12"]}, {"name": "R. do Clube 3", "times": ["07:31", "08:13", "08:52", "09:57", "10:42", "11:27", "12:12", "12:57", "13:42", "14:27", "15:12", "15:57", "16:42", "17:27", "18:12"]}, {"name": "Urb. Jobevi 1", "times": ["07:32", "08:14", "08:53", "09:58", "10:43", "11:28", "12:13", "12:58", "13:43", "14:28", "15:13", "15:58", "16:43", "17:28", "18:13"]}, {"name": "Sesmarias 1", "times": ["07:33", "08:15", "08:54", "09:59", "10:44", "11:29", "12:14", "12:59", "13:44", "14:29", "15:14", "15:59", "16:44", "17:29", "18:14"]}, {"name": "Sesmarias de Baixo 1", "times": ["07:34", "08:16", null, null, "10:45", null, null, "13:00", "13:45", null, null, "16:00", null, null, "18:15"]}, {"name": "Vale das Hortas 3", "times": ["07:35", "08:17", null, null, "10:46", null, null, "13:01", "13:46", null, null, "16:01", null, null, "18:16"]}, {"name": "Vale das Hortas 2", "times": ["07:35", "08:17", null, null, "10:46", null, null, "13:01", "13:46", null, null, "16:01", null, null, "18:16"]}, {"name": "Vale das Hortas 1", "times": ["07:36", "08:18", null, null, "10:47", null, null, "13:02", "13:47", null, null, "16:02", null, null, "18:17"]}, {"name": "Igr. da Penina 3", "times": ["07:38", "08:20", null, null, "10:49", null, null, "13:04", "13:49", null, null, "16:04", null, null, "18:19"]}]};
        const route11_inSchedule = {"stops": [{"name": "Igr. da Penina 3", "times": [null, "07:38", "08:20", null, null, "10:50"]}, {"name": "Vale das Hortas 6", "times": [null, "07:40", "08:22", null, null, "10:52"]}, {"name": "Sesmarias de Baixo 2", "times": [null, "07:41", "08:23", null, null, "10:53"]}, {"name": "Sesmarias 2", "times": ["07:05", "07:42", "08:24", "09:20", "10:05", "10:54"]}, {"name": "Urb. Jobevi 2", "times": ["07:06", "07:43", "08:25", "09:21", "10:06", "10:55"]}, {"name": "R. do Clube 4", "times": ["07:07", "07:44", "08:26", "09:22", "10:07", "10:56"]}, {"name": "R. do Clube 2", "times": ["07:08", "07:45", "08:27", "09:23", "10:08", "10:57"]}, {"name": "Pedra Mourinha 2", "times": ["07:09", "07:46", "08:28", "09:24", "10:09", "10:58"]}, {"name": "Trav. da Pedra 2", "times": ["07:09", "07:46", "08:28", "09:24", "10:09", "10:58"]}, {"name": "JI/EB1 P. Mourinha / EB23 J. Fialho 2", "times": ["07:10", "07:47", "08:29", "09:25", "10:10", "10:59"]}, {"name": "Lu\u00eds de Cam\u00f5es 2", "times": ["07:11", "07:48", "08:30", "09:26", "10:11", "11:00"]}, {"name": "Lu\u00eds de Cam\u00f5es 4", "times": ["07:12", "07:49", "08:31", "09:27", "10:12", "11:01"]}, {"name": "EB23 Eng. Nuno Mergulh\u00e3o", "times": ["07:13", "07:50", "08:32", "09:28", "10:13", "11:02"]}, {"name": "Rot. Pedra Mourinha 2", "times": ["07:14", "07:51", "08:33", "09:29", "10:14", "11:03"]}, {"name": "Finan\u00e7as", "times": ["07:16", "07:53", "08:35", "09:31", "10:16", "11:05"]}, {"name": "Mercado (Av. Dr. F. S\u00e1 Carneiro) 1", "times": ["07:17", "07:54", "08:36", "09:32", "10:17", "11:06"]}, {"name": "Centro de Sa\u00fade", "times": ["07:20", "07:57", "08:39", "09:35", "10:20", "11:09"]}, {"name": "EB1 Major David Neto 2", "times": ["07:21", "07:58", "08:40", "09:36", "10:21", "11:10"]}, {"name": "Portimonense", "times": ["07:22", "07:59", "08:41", "09:37", "10:22", "11:11"]}, {"name": "C\u00e2mara Municipal 1", "times": ["07:23", "08:00", "08:42", "09:38", "10:23", "11:12"]}, {"name": "Largo do Dique 2", "times": ["07:24", "08:01", "08:43", "09:39", "10:24", "11:13"]}, {"name": "Av. Afonso Henriques", "times": ["07:24", "08:01", "08:43", "09:39", "10:24", "11:13"]}, {"name": "Casa dos Pescadores", "times": ["07:25", "08:02", "08:44", "09:40", "10:25", "11:14"]}, {"name": "Museu 2", "times": ["07:26", "08:03", "08:45", "09:41", "10:26", "11:15"]}, {"name": "R. Sid\u00f3nio Pais 2", "times": ["07:26", "08:03", "08:45", "09:41", "10:26", "11:15"]}, {"name": "Rainha D. Am\u00e9lia 2", "times": ["07:27", "08:04", "08:46", "09:42", "10:27", "11:16"]}, {"name": "Sec. Poeta Ant\u00f3nio Aleixo 3", "times": [null, null, null, null, null, null]}, {"name": "Sec. Poeta Ant\u00f3nio Aleixo 4", "times": ["07:28", "08:05", "08:47", "09:43", "10:28", "11:17"]}, {"name": "EB23 D. Martinho C. Branco 2", "times": ["07:29", "08:06", "08:48", "09:44", "10:29", "11:18"]}, {"name": "JI/EB1 Pontal 2", "times": ["07:31", "08:08", "08:50", "09:46", "10:31", "11:20"]}, {"name": "Encosta da Marina 2", "times": ["07:32", "08:09", "08:51", "09:47", "10:32", "11:21"]}, {"name": "Quinta das Parreiras 2", "times": ["07:34", "08:11", "08:53", "09:49", "10:34", "11:23"]}, {"name": "Hotel J\u00fapiter", "times": ["07:36", "08:13", "08:55", "09:51", "10:36", "11:25"]}, {"name": "Hotel Oriental", "times": ["07:37", "08:14", "08:56", "09:52", "10:37", "11:26"]}, {"name": "Fortaleza", "times": ["07:38", "08:15", "08:57", "09:53", "10:38", "11:27"]}]};
        const route34_outSchedule = {"stops": [{"name": "Ladeira do Vau 1", "times": ["07:25", "08:35", "11:50", "12:56", "14:45", "16:15", "17:30", "18:35"]}, {"name": "Rot. Ladeira do Vau 2", "times": ["07:26", "08:36", "11:51", "12:57", "14:46", "16:16", "17:31", "18:36"]}, {"name": "Papagaia 2", "times": ["07:26", "08:36", "11:51", "12:57", "14:46", "16:16", "17:31", "18:36"]}, {"name": "Rot. Malheiro 2", "times": ["07:27", "08:37", "11:52", "12:58", "14:47", "16:17", "17:32", "18:37"]}, {"name": "Vendas 2", "times": ["07:27", "08:37", "11:52", "12:58", "14:47", "16:17", "17:32", "18:37"]}, {"name": "Bom Retiro 2", "times": ["07:29", "08:39", "11:54", "13:00", "14:49", "16:19", "17:34", "18:39"]}, {"name": "R. 25 de Abril", "times": ["07:30", "08:40", "11:55", "13:01", "14:50", "16:20", "17:35", "18:40"]}, {"name": "Companheira", "times": ["07:30", "08:40", "11:55", "13:01", "14:50", "16:20", "17:35", "18:40"]}, {"name": "R. Francisco Monteiro", "times": ["07:31", "08:41", "11:56", "13:02", "14:51", "16:21", "17:36", "18:41"]}, {"name": "Bom Retiro 1", "times": ["07:32", "08:42", "11:57", "13:03", "14:52", "16:22", "17:37", "18:42"]}, {"name": "Hospital", "times": ["07:34", "08:44", "11:59", "13:05", "14:54", "16:24", "17:39", "18:44"]}, {"name": "Rot. Hospital 2", "times": ["07:35", "08:45", "12:00", "13:06", "14:55", "16:25", "17:40", "18:45"]}, {"name": "Cardosas 2", "times": ["07:37", "08:47", "12:02", "13:08", "14:57", "16:27", "17:42", "18:47"]}, {"name": "Romanzeiras 1", "times": ["07:38", "08:48", "12:03", "13:09", "14:58", "16:28", "17:43", "18:48"]}, {"name": "CRACEP 1", "times": ["07:38", "08:48", "12:03", "13:09", "14:58", "16:28", "17:43", "18:48"]}, {"name": "Retail Center 1", "times": ["07:39", "08:49", "12:04", "13:10", "14:59", "16:29", "17:44", "18:49"]}, {"name": "GNR 2", "times": ["07:40", "08:50", "12:05", "13:11", "15:00", "16:30", "17:45", "18:50"]}, {"name": "Centro de Sa\u00fade", "times": ["07:42", null, null, "13:13", null, null, null, "18:52"]}, {"name": "Eng. Amaro da Costa", "times": ["07:43", null, null, "13:14", null, null, null, "18:53"]}, {"name": "Sec. Manuel T. Gomes 1", "times": ["07:44", null, null, "13:15", null, null, null, "18:54"]}, {"name": "Rot. Pedra Mourinha 1", "times": ["07:46", "08:51", "12:06", "13:17", "15:01", "16:31", "17:46", "18:56"]}, {"name": "EB23 Eng. Nuno Mergulh\u00e3o", "times": ["07:47", "08:52", "12:07", "13:18", "15:02", "16:32", "17:47", "18:57"]}, {"name": "Lu\u00eds de Cam\u00f5es 3", "times": ["07:48", "08:53", "12:08", "13:19", "15:03", "16:33", "17:48", "18:58"]}, {"name": "Lu\u00eds de Cam\u00f5es 1", "times": ["07:49", "08:54", "12:09", "13:20", "15:04", "16:34", "17:49", "18:59"]}, {"name": "JI/EB1 P. Mourinha / EB23 J. Fialho 1", "times": ["07:50", "08:55", "12:10", "13:21", "15:05", "16:35", "17:50", "19:00"]}, {"name": "Trav. da Pedra 1", "times": ["07:51", "08:56", "12:11", "13:22", "15:06", "16:36", "17:51", "19:01"]}, {"name": "Pedra Mourinha 1", "times": ["07:51", "08:56", "12:11", "13:22", "15:06", "16:36", "17:51", "19:01"]}, {"name": "Pedra Mourinha 3", "times": ["07:52", "08:57", "12:12", "13:23", "15:07", "16:37", "17:52", "19:02"]}, {"name": "Algarve Sol 2", "times": ["07:52", "08:57", "12:12", "13:23", "15:07", "16:37", "17:52", "19:02"]}, {"name": "Bairro Independente 2", "times": ["07:53", "08:58", "12:13", "13:24", "15:08", "16:38", "17:53", "19:03"]}, {"name": "Quinta das Oliveiras 2", "times": ["07:54", "08:59", "12:14", "13:25", "15:09", "16:39", "17:54", "19:04"]}, {"name": "Estr. Bemposta 1", "times": ["07:55", "09:00", "12:15", "13:26", "15:10", "16:40", "17:55", "19:05"]}, {"name": "Dep. de \u00c1gua 1", "times": ["07:56", "09:01", "12:16", "13:27", "15:11", "16:41", "17:56", "19:06"]}, {"name": "Bemposta 3", "times": ["07:57", "09:02", "12:17", "13:28", "15:12", "16:42", "17:57", "19:07"]}, {"name": "EB23/S Bemposta", "times": ["07:58", "09:03", "12:18", "13:29", "15:13", "16:43", "17:58", "19:08"]}]};
        const route34_inSchedule = {"stops": [{"name": "EB23/S Bemposta", "times": ["08:00", "09:05", "12:18", "14:00", "15:30", "17:00", "18:00", "19:08"]}, {"name": "Bemposta 2", "times": ["08:02", "09:07", "12:20", "14:02", "15:32", "17:02", "18:02", "19:10"]}, {"name": "Dep. de \u00c1gua 2", "times": ["08:03", "09:08", "12:21", "14:03", "15:33", "17:03", "18:03", "19:11"]}, {"name": "Estr. Bemposta 2", "times": ["08:04", "09:09", "12:22", "14:04", "15:34", "17:04", "18:04", "19:12"]}, {"name": "Quinta das Oliveiras 1", "times": ["08:04", "09:09", "12:22", "14:04", "15:34", "17:04", "18:04", "19:12"]}, {"name": "Bairro Independente 1", "times": ["08:05", "09:10", "12:23", "14:05", "15:35", "17:05", "18:05", "19:13"]}, {"name": "Algarve Sol 1", "times": ["08:06", "09:11", "12:24", "14:06", "15:36", "17:06", "18:06", "19:14"]}, {"name": "Pedra Mourinha 4", "times": ["08:06", "09:11", "12:24", "14:06", "15:36", "17:06", "18:06", "19:14"]}, {"name": "Pedra Mourinha 2", "times": ["08:07", "09:12", "12:25", "14:07", "15:37", "17:07", "18:07", "19:15"]}, {"name": "Trav. da Pedra 2", "times": ["08:07", "09:12", "12:25", "14:07", "15:37", "17:07", "18:07", "19:15"]}, {"name": "JI/EB1 P. Mourinha / EB23 J. Fialho 2", "times": ["08:08", "09:13", "12:26", "14:08", "15:38", "17:08", "18:08", "19:16"]}, {"name": "Lu\u00eds de Cam\u00f5es 2", "times": ["08:09", "09:14", "12:27", "14:09", "15:39", "17:09", "18:09", "19:17"]}, {"name": "Lu\u00eds de Cam\u00f5es 4", "times": ["08:09", "09:14", "12:27", "14:09", "15:39", "17:09", "18:09", "19:17"]}, {"name": "EB23 Eng. Nuno Mergulh\u00e3o", "times": ["08:10", "09:15", "12:28", "14:10", "15:40", "17:10", "18:10", "19:18"]}, {"name": "Rot. Pedra Mourinha 2", "times": ["08:12", "09:17", "12:30", "14:12", "15:42", "17:12", "18:12", "19:20"]}, {"name": "Centro de Sa\u00fade", "times": ["08:14", "09:19", "12:32", "14:14", null, null, "18:14", null]}, {"name": "Eng. Amaro da Costa", "times": ["08:14", "09:19", "12:32", "14:14", null, null, "18:14", null]}, {"name": "Sec. Manuel T. Gomes 1", "times": ["08:15", "09:20", "12:33", "14:15", null, null, "18:15", null]}, {"name": "GNR 1", "times": ["08:17", "09:22", "12:35", "14:17", "15:43", "17:13", "18:17", "19:21"]}, {"name": "Retail Center 2", "times": ["08:18", "09:23", "12:36", "14:18", "15:44", "17:14", "18:18", "19:22"]}, {"name": "CRACEP 2", "times": ["08:19", "09:24", "12:37", "14:19", "15:45", "17:15", "18:19", "19:23"]}, {"name": "Romanzeiras 2", "times": ["08:19", "09:24", "12:37", "14:19", "15:45", "17:15", "18:19", "19:23"]}, {"name": "Cardosas 1", "times": ["08:20", "09:25", "12:38", "14:20", "15:46", "17:16", "18:20", "19:24"]}, {"name": "Rot. Hospital 1", "times": ["08:22", "09:27", "12:40", "14:22", "15:48", "17:18", "18:22", "19:26"]}, {"name": "Hospital", "times": ["08:23", "09:28", "12:41", "14:23", "15:49", "17:19", "18:23", "19:27"]}, {"name": "Bom Retiro 2", "times": ["08:25", "09:30", "12:43", "14:25", "15:51", "17:21", "18:25", "19:29"]}, {"name": "R. 25 de Abril", "times": ["08:26", "09:31", "12:44", "14:26", "15:52", "17:22", "18:26", "19:30"]}, {"name": "Companheira", "times": ["08:27", "09:32", "12:45", "14:27", "15:53", "17:23", "18:27", "19:31"]}, {"name": "R. Francisco Monteiro", "times": ["08:27", "09:32", "12:45", "14:27", "15:53", "17:23", "18:27", "19:31"]}, {"name": "Bom Retiro 1", "times": ["08:28", "09:33", "12:46", "14:28", "15:54", "17:24", "18:28", "19:32"]}, {"name": "Vendas 1", "times": ["08:30", "09:35", "12:48", "14:30", "15:56", "17:26", "18:30", "19:34"]}, {"name": "Rot. Malheiro 1", "times": ["08:31", "09:36", "12:49", "14:31", "15:57", "17:27", "18:31", "19:35"]}, {"name": "Papagaia 1", "times": ["08:31", "09:36", "12:49", "14:31", "15:57", "17:27", "18:31", "19:35"]}, {"name": "Rot. Ladeira do Vau 1", "times": ["08:32", "09:37", "12:50", "14:32", "15:58", "17:28", "18:32", "19:36"]}, {"name": "Ladeira do Vau 2", "times": ["08:33", "09:38", "12:51", "14:33", "15:59", "17:29", "18:33", "19:37"]}]};
        const route12_outSchedule = {"stops": [{"name": "Gare Rodovi\u00e1ria de Portim\u00e3o", "times": ["07:15", "07:50", "08:25", "09:00", "09:34", "10:50", "12:00", "13:09", "14:19", "15:30", "16:39", "17:50", "19:00"]}, {"name": "Esta\u00e7\u00e3o de Comboios", "times": ["07:18", "07:53", "08:27", "09:02", "09:37", "10:52", "12:02", "13:12", "14:22", "15:33", "16:42", "17:53", "19:03"]}, {"name": "Largo Gil Eanes", "times": ["07:19", "07:54", "08:28", "09:03", "09:38", "10:53", "12:03", "13:13", "14:23", "15:33", "16:44", "17:54", "19:04"]}, {"name": "Gil Eanes / Av. Dr. F. S\u00e1 Carneiro 2", "times": ["07:20", "07:54", "08:29", "09:04", "09:39", "10:54", "12:04", "13:14", "14:24", "15:34", "16:45", "17:55", "19:05"]}, {"name": "EB23 Prof. Jos\u00e9 Buisel 1", "times": ["07:20", "07:55", "08:30", "09:05", "09:40", "10:55", "12:05", "13:15", "14:25", "15:35", "16:46", "17:56", "19:06"]}, {"name": "Bombeiros (Frente) 2", "times": ["07:21", "07:56", "08:31", "09:06", "09:41", "10:56", "12:06", "13:16", "14:26", "15:36", "16:47", "17:57", "19:07"]}, {"name": "Mercado (Av. Dr. F. S\u00e1 Carneiro) 1", "times": ["07:22", "07:57", "08:32", "09:07", "09:42", "10:57", "12:07", "13:17", "14:27", "15:37", "16:48", "17:58", "19:08"]}, {"name": "Sec. Manuel T. Gomes 1", "times": ["07:23", "07:58", "08:33", "09:08", "09:43", "10:58", "12:08", "13:18", "14:28", "15:38", "16:49", "17:59", "19:09"]}, {"name": "Rot. Pedra Mourinha 1", "times": ["07:25", "08:00", "08:35", "09:10", "09:45", "11:00", "12:10", "13:20", "14:30", "15:40", "16:51", "18:01", "19:11"]}, {"name": "EB23 Eng. Nuno Mergulh\u00e3o", "times": ["07:26", "08:01", "08:36", "09:11", "09:46", "11:01", "12:11", "13:21", "14:31", "15:41", "16:52", "18:02", "19:12"]}, {"name": "Lu\u00eds de Cam\u00f5es 3", "times": ["07:27", "08:02", "08:37", "09:12", "09:47", "11:02", "12:12", "13:22", "14:32", "15:42", "16:53", "18:03", "19:13"]}, {"name": "Lu\u00eds de Cam\u00f5es 1", "times": ["07:28", "08:03", "08:38", "09:13", "09:48", "11:03", "12:13", "13:23", "14:33", "15:43", "16:54", "18:04", "19:14"]}, {"name": "JI/EB1 P. Mourinha / EB23 J. Fialho 1", "times": ["07:29", "08:04", "08:39", "09:14", "09:49", "11:04", "12:14", "13:24", "14:34", "15:44", "16:55", "18:05", "19:15"]}, {"name": "Trav. da Pedra 1", "times": ["07:29", "08:04", "08:39", "09:14", "09:49", "11:04", "12:14", "13:24", "14:34", "15:44", "16:55", "18:05", "19:15"]}, {"name": "Pedra Mourinha 1", "times": ["07:30", "08:05", "08:40", "09:15", "09:50", "11:05", "12:15", "13:25", "14:35", "15:45", "16:56", "18:06", "19:16"]}, {"name": "Algarve Sol 2", "times": ["07:30", "08:05", "08:40", "09:15", "09:50", "11:05", "12:15", "13:25", "14:35", "15:45", "16:56", "18:06", "19:16"]}, {"name": "Bairro Independente 2", "times": ["07:31", "08:06", "08:41", "09:16", "09:51", "11:06", "12:16", "13:26", "14:36", "15:46", "16:57", "18:07", "19:17"]}, {"name": "Quinta das Oliveiras 2", "times": ["07:32", "08:07", "08:42", "09:17", "09:52", "11:07", "12:17", "13:27", "14:37", "15:47", "16:58", "18:08", "19:18"]}, {"name": "Estr. Bemposta 1", "times": ["07:33", "08:08", "08:43", "09:18", "09:53", "11:08", "12:18", "13:28", "14:38", "15:48", "16:59", "18:09", "19:19"]}, {"name": "Dep. de \u00c1gua 1", "times": ["07:33", "08:08", "08:43", "09:18", "09:53", "11:08", "12:18", "13:28", "14:38", "15:48", "16:59", "18:09", "19:19"]}, {"name": "Bemposta 4", "times": ["07:34", "08:09", "08:44", "09:19", "09:54", "11:09", "12:19", "13:29", "14:39", "15:49", "17:00", "18:10", "19:20"]}, {"name": "Portas de Sol 2", "times": ["07:35", "08:10", "08:45", "09:20", "09:55", "11:10", "12:20", "13:30", "14:40", "15:50", "17:01", "18:11", "19:21"]}, {"name": "Portas de Sol (Cruz.) 2", "times": ["07:36", "08:11", "08:46", "09:21", "09:56", "11:11", "12:21", "13:31", "14:41", "15:51", "17:01", "18:12", "19:22"]}, {"name": "EB23/S Bemposta", "times": ["07:37", "08:12", "08:47", "09:22", "09:57", "11:12", "12:22", "13:32", "14:42", "15:52", "17:03", "18:13", "19:23"]}, {"name": "Bemposta 2", "times": ["07:38", "08:13", "08:48", "09:23", "09:58", "11:13", "12:23", "13:33", "14:43", "15:53", "17:04", "18:14", "19:24"]}, {"name": "Av. da Europa 1", "times": ["07:40", "08:15", "08:50", "09:25", "10:00", "11:15", "12:25", "13:35", "14:45", "15:55", "17:06", "18:16", "19:26"]}, {"name": "R. da Madeira 1", "times": ["07:41", "08:16", "08:51", "09:26", "10:01", "11:16", "12:26", "13:36", "14:46", "15:56", "17:07", "18:17", "19:27"]}, {"name": "Alvor Sol 1", "times": ["07:42", "08:17", "08:52", "09:27", "10:02", "11:17", "12:27", "13:37", "14:47", "15:57", "17:08", "18:18", "19:28"]}, {"name": "Galazeira 1", "times": ["07:43", "08:18", "08:53", "09:28", "10:03", "11:18", "12:28", "13:38", "14:48", "15:58", "17:09", "18:19", "19:29"]}, {"name": "Po\u00e7o Novo 1", "times": ["07:44", "08:19", "08:54", "09:29", "10:04", "11:19", "12:29", "13:39", "14:49", "16:00", "17:10", "18:20", "19:30"]}, {"name": "Montes de Alvor (Cruz.) 1", "times": ["07:45", "08:20", "08:55", "09:30", "10:05", "11:20", "12:30", "13:40", "14:50", "16:01", "17:11", "18:21", "19:31"]}, {"name": "Montes de Alvor 1", "times": ["07:46", "08:21", "08:56", "09:31", "10:06", "11:21", "12:31", "13:41", "14:51", "16:02", "17:12", "18:22", "19:32"]}, {"name": "Montes de Alvor 1", "times": ["07:47", "08:22", "08:57", "09:32", "10:07", "11:22", "12:32", "13:42", "14:52", "16:03", "17:13", "18:23", "19:33"]}]};
        const route12_inSchedule = {"stops": [{"name": "Montes de Alvor 2", "times": ["07:15", "07:50", "08:25", "09:00", "09:34", "10:15", "11:25", "12:34", "13:44", "14:44", "16:05", "17:14", "18:25"]}, {"name": "Montes de Alvor (Cruz.) 2", "times": ["07:15", "07:50", "08:25", "09:00", "09:34", "10:15", "11:25", "12:34", "13:44", "14:44", "16:05", "17:14", "18:25"]}, {"name": "Po\u00e7o Novo 2", "times": ["07:16", "07:50", "08:25", "09:00", "09:35", "10:16", "11:25", "12:35", "13:45", "14:45", "16:06", "17:16", "18:26"]}, {"name": "Galazeira 2", "times": ["07:16", "07:51", "08:26", "09:01", "09:36", "10:16", "11:26", "12:36", "13:46", "14:46", "16:07", "17:17", "18:27"]}, {"name": "Alvor Sol 2", "times": ["07:17", "07:52", "08:27", "09:02", "09:37", "10:17", "11:27", "12:37", "13:47", "14:47", "16:08", "17:18", "18:28"]}, {"name": "R. da Madeira 2", "times": ["07:18", "07:53", "08:28", "09:03", "09:38", "10:18", "11:28", "12:38", "13:48", "14:48", "16:09", "17:19", "18:29"]}, {"name": "Av. da Europa 2", "times": ["07:19", "07:54", "08:29", "09:04", "09:39", "10:19", "11:29", "12:39", "13:49", "14:49", "16:10", "17:20", "18:30"]}, {"name": "Bemposta 1", "times": ["07:19", "07:54", "08:29", "09:04", "09:39", "10:19", "11:29", "12:39", "13:49", "14:49", "16:10", "17:20", "18:30"]}, {"name": "EB23/S Bemposta", "times": ["07:20", "07:55", "08:30", "09:05", "09:40", "10:20", "11:30", "12:40", "13:50", "14:50", "16:11", "17:21", "18:31"]}, {"name": "Portas de Sol (Cruz.) 1", "times": ["07:22", "07:57", "08:32", "09:07", "09:42", "10:22", "11:32", "12:42", "13:52", "14:52", "16:13", "17:23", "18:33"]}, {"name": "Portas de Sol 1", "times": ["07:23", "07:58", "08:33", "09:08", "09:43", "10:23", "11:33", "12:43", "13:53", "14:53", "16:14", "17:24", "18:34"]}, {"name": "Bemposta 1", "times": ["07:24", "08:00", "08:34", "09:09", "09:44", "10:24", "11:34", "12:44", "13:54", "14:54", "16:15", "17:25", "18:35"]}, {"name": "Dep. de \u00c1gua 2", "times": ["07:25", "08:00", "08:35", "09:10", "09:45", "10:25", "11:35", "12:45", "13:55", "14:55", "16:16", "17:26", "18:36"]}, {"name": "Estr. Bemposta 2", "times": ["07:26", "08:01", "08:36", "09:11", "09:46", "10:26", "11:36", "12:46", "13:56", "14:56", "16:17", "17:27", "18:37"]}, {"name": "Quinta das Oliveiras 1", "times": ["07:26", "08:01", "08:36", "09:11", "09:46", "10:26", "11:36", "12:46", "13:56", "14:56", "16:17", "17:27", "18:37"]}, {"name": "Bairro Independente 1", "times": ["07:27", "08:02", "08:37", "09:12", "09:47", "10:27", "11:37", "12:47", "13:57", "14:57", "16:18", "17:28", "18:38"]}, {"name": "Algarve Sol 1", "times": ["07:28", "08:03", "08:38", "09:13", "09:48", "10:28", "11:38", "12:48", "13:58", "14:58", "16:19", "17:29", "18:39"]}, {"name": "Pedra Mourinha 4", "times": ["07:28", "08:03", "08:38", "09:13", "09:48", "10:28", "11:38", "12:48", "13:58", "14:58", "16:19", "17:29", "18:39"]}, {"name": "Pedra Mourinha 2", "times": ["07:29", "08:04", "08:39", "09:14", "09:49", "10:29", "11:39", "12:49", "13:59", "15:00", "16:20", "17:30", "18:40"]}, {"name": "Trav. da Pedra 2", "times": ["07:29", "08:04", "08:39", "09:14", "09:49", "10:29", "11:39", "12:49", "14:00", "15:00", "16:20", "17:30", "18:40"]}, {"name": "JI/EB1 P. Mourinha / EB23 J. Fialho 2", "times": ["07:30", "08:05", "08:40", "09:15", "09:50", "10:30", "11:40", "12:50", "14:00", "15:00", "16:21", "17:31", "18:41"]}, {"name": "Lu\u00eds de Cam\u00f5es 2", "times": ["07:31", "08:06", "08:41", "09:16", "09:51", "10:31", "11:41", "12:51", "14:01", "15:01", "16:22", "17:32", "18:42"]}, {"name": "Lu\u00eds de Cam\u00f5es 4", "times": ["07:32", "08:07", "08:42", "09:17", "09:52", "10:32", "11:42", "12:52", "14:02", "15:02", "16:23", "17:33", "18:43"]}, {"name": "EB23 Eng. Nuno Mergulh\u00e3o", "times": ["07:33", "08:08", "08:43", "09:18", "09:53", "10:33", "11:43", "12:53", "14:03", "15:03", "16:24", "17:34", "18:44"]}, {"name": "Rot. Pedra Mourinha 2", "times": ["07:34", "08:09", "08:44", "09:19", "09:54", "10:34", "11:44", "12:54", "14:04", "15:04", "16:25", "17:35", "18:45"]}, {"name": "Centro de Sa\u00fade", "times": ["07:36", "08:11", "08:46", "09:21", "09:56", "10:36", "11:46", "12:56", "14:06", "15:06", "16:27", "17:37", "18:47"]}, {"name": "Eng. Amaro da Costa", "times": ["07:37", "08:12", "08:47", "09:22", "09:57", "10:37", "11:47", "12:57", "14:07", "15:07", "16:28", "17:38", "18:48"]}, {"name": "Mercado (Av. Dr. F. S\u00e1 Carneiro) 2", "times": ["07:38", "08:13", "08:48", "09:23", "09:58", "10:38", "11:48", "12:58", "14:08", "15:08", "16:29", "17:39", "18:49"]}, {"name": "Bombeiros (Frente) 1", "times": ["07:39", "08:14", "08:49", "09:24", "10:00", "10:39", "11:49", "13:00", "14:09", "15:09", "16:30", "17:40", "18:50"]}, {"name": "EB23 Prof. Jos\u00e9 Buisel 2", "times": ["07:40", "08:15", "08:50", "09:25", "10:00", "10:40", "11:50", "13:00", "14:10", "15:10", "16:31", "17:41", "18:51"]}, {"name": "Gil Eanes / Av. Dr. F.S\u00e1 Carneiro 1", "times": ["07:41", "08:16", "08:51", "09:26", "10:01", "10:41", "11:51", "13:01", "14:11", "15:11", "16:32", "17:42", "18:52"]}, {"name": "Largo Gil Eanes", "times": ["07:42", "08:17", "08:52", "09:27", "10:02", "10:42", "11:52", "13:02", "14:12", "15:12", "16:33", "17:43", "18:53"]}, {"name": "Esta\u00e7\u00e3o de Comboios", "times": ["07:43", "08:18", "08:53", "09:28", "10:03", "10:43", "11:53", "13:03", "14:13", "15:13", "16:34", "17:44", "18:54"]}, {"name": "Gare Rodovi\u00e1ria de Portim\u00e3o", "times": ["07:46", "08:21", "08:56", "09:31", "10:06", "10:46", "11:56", "13:06", "14:16", "15:16", "16:37", "17:47", "18:57"]}]};

        const routeSchedules = {
            '11-out': route11_outSchedule,
            '11-in': route11_inSchedule,
            '12-out': route12_outSchedule,
            '12-in': route12_inSchedule,
            '34-out': route34_outSchedule,
            '34-in': route34_inSchedule
        };
        
        const stopCoordinates = {
            'Fortaleza': [37.1200, -8.5300],
            'Gare Rodovi√°ria de Portim√£o': [37.1900, -8.5400],
            'Ladeira do Vau 1': [37.1250, -8.5500],
            'EB23/S Bemposta': [37.1324, -8.5446],
            'Igreja de Penina': [37.1295, -8.5475],
            'Igr. da Penina 3': [37.1295, -8.5475],
            'Montes de Alvor 2': [37.1304, -8.5466]
        };
        
        let currentSchedule = routeSchedules['11-out'];
        let userLocation = null;
        
        function changeRoute() {
            const routeValue = document.getElementById('routeSelect').value;
            currentSchedule = routeSchedules[routeValue];
            populateStops();
            document.getElementById('routeInfo').classList.remove('show');
            if (userLocation) findAndSelectNearestStop();
        }
        
        function populateStops() {
            const fromSelect = document.getElementById('fromStop');
            const toSelect = document.getElementById('toStop');
            fromSelect.innerHTML = '<option value="">-- Select starting stop --</option>';
            toSelect.innerHTML = '<option value="">-- Select destination --</option>';
            currentSchedule.stops.forEach((stop, index) => {
                const opt1 = document.createElement('option');
                opt1.value = index;
                opt1.textContent = stop.name;
                fromSelect.appendChild(opt1);
                const opt2 = document.createElement('option');
                opt2.value = index;
                opt2.textContent = stop.name;
                toSelect.appendChild(opt2);
            });
        }
        
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }
        
        function findAndSelectNearestStop() {
            let nearest = null;
            let minDist = Infinity;
            let nearestIdx = -1;
            
            currentSchedule.stops.forEach((stop, idx) => {
                let coords = stopCoordinates[stop.name] || [37.14, -8.54];
                const dist = calculateDistance(userLocation.lat, userLocation.lon, coords[0], coords[1]);
                if (dist < minDist) {
                    minDist = dist;
                    nearest = stop;
                    nearestIdx = idx;
                }
            });
            
            if (nearest) {
                document.getElementById('fromStop').value = nearestIdx;
                const distM = (minDist * 1000).toFixed(0);
                document.getElementById('locationStatus').innerHTML = 
                    `Nearest stop: <strong>${nearest.name}</strong> (${distM}m away)`;
            }
        }
        
        function getLocation() {
            const statusIcon = document.getElementById('statusIcon');
            const locationStatus = document.getElementById('locationStatus');
            const errorMessage = document.getElementById('errorMessage');
            const btn = document.getElementById('locationBtn');
            
            errorMessage.innerHTML = '';
            btn.disabled = true;
            btn.textContent = 'üì° Getting location...';
            
            if (!navigator.geolocation) {
                errorMessage.innerHTML = '<div class="error">Geolocation not supported</div>';
                btn.disabled = false;
                btn.textContent = 'üìç Get My Location';
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = {
                        lat: position.coords.latitude,
                        lon: position.coords.longitude
                    };
                    statusIcon.classList.add('active');
                    locationStatus.textContent = 'Location found!';
                    document.getElementById('coordinates').textContent = 
                        `Lat: ${userLocation.lat.toFixed(6)}, Lon: ${userLocation.lon.toFixed(6)}`;
                    findAndSelectNearestStop();
                    btn.textContent = '‚úì Location Updated';
                    btn.disabled = false;
                },
                (error) => {
                    let errorMsg = 'Unable to get location';
                    if (error.code === error.PERMISSION_DENIED) {
                        errorMsg = 'Location permission denied';
                    }
                    errorMessage.innerHTML = `<div class="error">${errorMsg}</div>`;
                    statusIcon.classList.remove('active');
                    locationStatus.textContent = 'Location unavailable';
                    btn.disabled = false;
                    btn.textContent = 'üìç Get My Location';
                }
            );
        }
        
        function getNextBuses(fromIdx, toIdx) {
            const now = new Date();
            const currentMin = now.getHours() * 60 + now.getMinutes();
            const nextBuses = [];
            const numDep = currentSchedule.stops[0].times.length;
            
            for (let busIdx = 0; busIdx < numDep; busIdx++) {
                const depTime = currentSchedule.stops[fromIdx].times[busIdx];
                const arrTime = currentSchedule.stops[toIdx].times[busIdx];
                if (!depTime || !arrTime) continue;
                
                const [depH, depM] = depTime.split(':').map(Number);
                const depMin = depH * 60 + depM;
                
                if (depMin >= currentMin) {
                    const [arrH, arrM] = arrTime.split(':').map(Number);
                    const arrMin = arrH * 60 + arrM;
                    const waitMin = depMin - currentMin;
                    const travelMin = arrMin - depMin;
                    
                    nextBuses.push({
                        depTime: depTime,
                        arrTime: arrTime,
                        waitMin: waitMin,
                        travelMin: travelMin
                    });
                }
            }
            return nextBuses.slice(0, 3);
        }
        
        function calculateRoute() {
            const fromIdx = parseInt(document.getElementById('fromStop').value);
            const toIdx = parseInt(document.getElementById('toStop').value);
            const routeInfo = document.getElementById('routeInfo');
            
            if (isNaN(fromIdx) || isNaN(toIdx)) {
                routeInfo.classList.remove('show');
                return;
            }
            
            if (fromIdx >= toIdx) {
                document.getElementById('errorMessage').innerHTML = 
                    '<div class="error">Destination must come after starting point</div>';
                routeInfo.classList.remove('show');
                return;
            }
            
            document.getElementById('errorMessage').innerHTML = '';
            
            const fromStop = currentSchedule.stops[fromIdx];
            const toStop = currentSchedule.stops[toIdx];
            const stopsCount = toIdx - fromIdx;
            
            document.getElementById('fromDisplay').textContent = fromStop.name;
            document.getElementById('toDisplay').textContent = toStop.name;
            document.getElementById('stopsCount').textContent = stopsCount;
            
            const nextBuses = getNextBuses(fromIdx, toIdx);
            const busTimesDiv = document.getElementById('busTimes');
            
            if (nextBuses.length === 0) {
                busTimesDiv.innerHTML = '<div class="bus-time"><span class="info-label">No more buses today</span></div>';
            } else {
                busTimesDiv.innerHTML = nextBuses.map(bus => `
                    <div class="bus-time">
                        <div>
                            <div class="time-large">üöå ${bus.depTime} ‚Üí ${bus.arrTime}</div>
                            <div class="time-info">${bus.travelMin} min journey</div>
                        </div>
                        <span class="time-info">in ${bus.waitMin} min</span>
                    </div>
                `).join('');
            }
            
            routeInfo.classList.add('show');
        }
        
        populateStops();
    </script>
</body>
</html>